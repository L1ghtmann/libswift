#!/bin/bash

rm -rf tbds

for dir in versions/*; do
	version=$(basename "$dir")
	tbd_dir="tbds/$version"
	rm -rf "$tbd_dir"
	mkdir -p "$tbd_dir"
	for file in "$dir"/*; do
		filename=$(basename "$file")
		filename=${filename%.*}
		cp "$file" "$tbd_dir/stage.dylib" # stage.dylib can be modified before dumping its tbd
		install_name_tool -id "${INSTALL_PATH%/}/$version/$filename.dylib" "$tbd_dir/stage.dylib"
		bin/tbdump "$tbd_dir/stage.dylib" > "$tbd_dir/$filename.tbd"
		echo "Dumped $version/$filename.tbd"
	done
	rm "$tbd_dir/stage.dylib"
done
